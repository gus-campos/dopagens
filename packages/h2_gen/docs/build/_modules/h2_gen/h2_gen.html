<!DOCTYPE html>
<html class="writer-html5" lang="pt-BR" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>h2_gen.h2_gen &mdash; Documentação dopings 0.1</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=88519e4e"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/translations.js?v=000972dd"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Buscar" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dopings
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Pesquisar documentos" aria-label="Pesquisar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu de navegação">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu de navegação móvel" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dopings</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Navegação da página">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Código do módulo</a></li>
      <li class="breadcrumb-item active">h2_gen.h2_gen</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Código fonte para h2_gen.h2_gen</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<div class="viewcode-block" id="phi">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.phi">[documentos]</a>
<span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retorna a imagem da n-ésima função phi, tal que:</span>

<span class="sd">    phi{0}               = 1</span>
<span class="sd">    phi{1}   ... phi{n}  = x^n</span>
<span class="sd">    phi{n+1} ... phi{2n} = y^n</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    i : int</span>
<span class="sd">        Índice da i-ésima função phi, ou seja phi{i}.</span>

<span class="sd">    x : float or np.ndarray</span>
<span class="sd">        Valor único de x, ou array de valores de x.</span>
<span class="sd">        Se array, precisa ter o mesmo tamanho de y.</span>

<span class="sd">    y : float or np.ndarray</span>
<span class="sd">        Valor único de y, ou array de valores de y.</span>
<span class="sd">        Se array, precisa ter o mesmo tamanho de x.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    z : float or np.ndarray</span>
<span class="sd">        Imagem da função phi{i}, ou array de imagens.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    
    <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span>

    <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">n</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;i&#39; must be less or equal to 2n.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="g">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.g">[documentos]</a>
<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dado uma matrix coluna de coeficiente do ajuste, calcula a iamgem da</span>
<span class="sd">    função:</span>

<span class="sd">    g(x,y) = C0 * phi{0}(x,y) + ... + C(2n+1) * phi{2n}(x,y)</span>

<span class="sd">    tal que:</span>

<span class="sd">    phi{0}               = 1</span>
<span class="sd">    phi{1}   ... phi{n}  = x^n</span>
<span class="sd">    phi{n+1} ... phi{2n} = y^n</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    x : float</span>
<span class="sd">        Valor de x.</span>

<span class="sd">    y: float</span>
<span class="sd">        Valor de y.</span>

<span class="sd">    C : np.ndarray</span>
<span class="sd">        Matriz coluna com os coeficientes do ajuste.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    z : float</span>
<span class="sd">        Imagem da função.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Encontrando o valor n, a partir da dimensão da matriz de coeficientes</span>
    <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1"># Somando as parcelas da função ajustada</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">+=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># Retornando imagem</span>
    <span class="k">return</span> <span class="n">z</span></div>


<div class="viewcode-block" id="graphine_radius">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.graphine_radius">[documentos]</a>
<span class="k">def</span> <span class="nf">graphine_radius</span><span class="p">(</span><span class="n">struct</span><span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        Estima um raio aproximado para a estrutura de grafino.</span>
<span class="sd">        </span>
<span class="sd">        Encontra o carbono mais afastado do centro de massa, e retorna 90% </span>
<span class="sd">        desta distância. Assume que o centro de massa da estrutura está </span>
<span class="sd">        em (0,0,0).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        struct : strucutre</span>
<span class="sd">            Estrutura para qual se calcular a estimativa.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        float</span>
<span class="sd">            Raio estimado para a estrutura.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">maior</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">struct</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">elem</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="n">maior</span><span class="p">:</span>
                    <span class="n">maior</span> <span class="o">=</span> <span class="n">length</span>

        <span class="c1"># Rotrnar a estimativa           </span>
        <span class="k">return</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">maior</span></div>


<div class="viewcode-block" id="h2_gen_output">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen">[documentos]</a>
<span class="k">class</span> <span class="nc">h2_gen</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classe de métodos estáticos para geração de estruturas cobertas por</span>
<span class="sd">    moléculas de H2.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    </span>
<span class="sd">    plot(xs, ys, zs, radius: float, C: np.ndarray=None)</span>

<span class="sd">        Gera um plot interativo de todos os átomos, dadas as coordenadas </span>
<span class="sd">        de todos eles. Se for passada uma matriz de coeficientes, plota </span>
<span class="sd">        também a curva ajustada.</span>
<span class="sd">    </span>
<span class="sd">    to_CM(struct : &quot;structure&quot;)</span>

<span class="sd">        Recebe uma estrutura e retorna a mesma movida para o seu centro </span>
<span class="sd">        de massa. Só considera os carbonos no cálculo do centro de </span>
<span class="sd">        massa.</span>
<span class="sd">    </span>
<span class="sd">    gen_arrays(struct : &quot;structure&quot;)</span>

<span class="sd">        Gera arrays xs, ys, zs das coordenadas dos átomos de uma </span>
<span class="sd">        estrutura.</span>
<span class="sd">    </span>
<span class="sd">    lin_reg(xs, ys, zs, n: int)</span>

<span class="sd">        Calcula  os coeficientes que ajustam, aos pontos fornecidos, uma </span>
<span class="sd">        curva do tipo:</span>

<span class="sd">        g(x,y) = C0 * phi{0}(x,y) + ... + C(2n+1) * phi{2n}(x,y)</span>
<span class="sd">    </span>
<span class="sd">    graphine_radius(struct: &quot;structure&quot;)</span>

<span class="sd">        Estima um raio aproximado para a estrutura de grafino.</span>
<span class="sd">        </span>
<span class="sd">        Encontra o carbono mais afastado do centro de massa, e retorna </span>
<span class="sd">        90% desta distância. Assume que o centro de massa da estrutura </span>
<span class="sd">        está em (0,0,0).</span>
<span class="sd">    </span>
<span class="sd">    gen_R2_coords_periodic(periodic_struct: &quot;periodic_structure&quot;,</span>
<span class="sd">                           nH2: int)</span>

<span class="sd">        Gera, para uma estrutura periódica, vários pontos no R2, </span>
<span class="sd">        dispostos em uma grade, que correspondem aos centros das </span>
<span class="sd">        moléculas de H2.</span>
<span class="sd">    </span>
<span class="sd">    gen_R2_coord_flake(struct: &quot;strucutre&quot;, nH2: int)</span>

<span class="sd">        Gera, para uma estrutura de formato arredondado, no R2, uma </span>
<span class="sd">        lista de com posições de H2.</span>
<span class="sd">    </span>
<span class="sd">    gen_R3_H2(R2_coords, C, otherside=False, vertical=False)</span>

<span class="sd">        Recebe pontos espalhados sobre um plano, e retorna pontos </span>
<span class="sd">        espalhados sobre uma superfície ajustada sobre os átomos da </span>
<span class="sd">        estrutura.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">##################### Auxiliar ################################################</span>
<div class="viewcode-block" id="h2_gen.plot">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen.plot">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gera um plot interativo de todos os átomos, dadas as coordenadas de </span>
<span class="sd">        todos eles. Se for passada uma matriz de coeficientes, plota também</span>
<span class="sd">        a curva ajustada.</span>

<span class="sd">        Parameters </span>
<span class="sd">        ----------</span>

<span class="sd">        xs, ys, zs : np.array[float]</span>
<span class="sd">            Array de floats das coordenadas dos átomos.</span>

<span class="sd">        radius : float</span>
<span class="sd">            Raio estimado da estrutura.</span>

<span class="sd">        C : np.ndarray[float], default = None</span>
<span class="sd">            Matriz coluna de coeficientes do ajuste de curva.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        
        <span class="c1">######################### ÁTOMOS ##########################################</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

        <span class="c1">######################### CURVA ###########################################</span>
        <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        
            <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

            <span class="c1"># Malha para o plot do plano</span>
            <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="c1"># Preenchendo valores de Z da malha</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">Z</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span>

            <span class="c1"># Plotando a grade</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="c1">################################# PLOTAGEM ################################</span>

        <span class="c1"># Limite dos eixos</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>

        <span class="c1"># Mostrando plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Fechando</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>


<div class="viewcode-block" id="h2_gen.to_CM">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen.to_CM">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">to_CM</span><span class="p">(</span><span class="n">struct</span> <span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recebe uma estrutura e retorna a mesma movida para o seu centro </span>
<span class="sd">        de massa. Só considera os carbonos no cálculo do centro de </span>
<span class="sd">        massa.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        struct : structure</span>
<span class="sd">            Estrutura a ser transladada.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        structure </span>
<span class="sd">            Estrutura transladada para o centro de massa.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

        <span class="c1"># Copia a structure para não alterar a original</span>
        <span class="n">struct</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Inicializando variáveis</span>
        <span class="n">center_of_mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Para cada átomo de carbono</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">struct</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">elem</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>

                <span class="c1"># Incrementar soma das posições e quantidade de carbonos</span>
                <span class="n">center_of_mass</span> <span class="o">+=</span> <span class="n">atom</span><span class="o">.</span><span class="n">coord</span>
                <span class="n">n_atoms</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Calcular centro de massa</span>
        <span class="n">center_of_mass</span> <span class="o">=</span> <span class="n">center_of_mass</span> <span class="o">/</span> <span class="n">n_atoms</span>

        <span class="c1"># Transladar cada átomo da estrutura</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">struct</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">center_of_mass</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">struct</span></div>


<div class="viewcode-block" id="h2_gen.gen_arrays">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen.gen_arrays">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gen_arrays</span><span class="p">(</span><span class="n">struct</span> <span class="p">:</span> <span class="s2">&quot;structure&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gera arrays xs, ys, zs das coordenadas dos átomos de uma </span>
<span class="sd">        estrutura.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        struct : structure</span>
<span class="sd">            Estrutura para a qual se deseja gerar os arrays.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        xs, ys, zs : np.array[float]</span>
<span class="sd">            Arrays das coordenadas x, y e z dos átomos da estrutura.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

        <span class="c1"># Listas</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="c1"># Dividindo as váriaveis em arrays diferentes</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">struct</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>

            <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">zs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Transformando em array</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">zs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># Retornando</span>
        <span class="k">return</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span></div>


    <span class="c1">#######################  Ajuste de curva ######################################</span>

<div class="viewcode-block" id="h2_gen.lin_reg">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen.lin_reg">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">lin_reg</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calcula  os coeficientes que ajustam, aos pontos fornecidos, uma </span>
<span class="sd">        curva do tipo:</span>

<span class="sd">        g(x,y) = C0 * phi{0}(x,y) + ... + C(2n+1) * phi{2n}(x,y)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        xs, ys, zs : np.ndarray</span>
<span class="sd">            Arrays com as coordenadas dos pontos/átomos. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        np.ndarray(shape=(2n+1))</span>
<span class="sd">            Matriz coluna de coeficiente do ajuste de curva, na forma:</span>

<span class="sd">        |   C0    | </span>
<span class="sd">        |   C1    | </span>
<span class="sd">        |    .    | </span>
<span class="sd">        |    .    | </span>
<span class="sd">        |    .    | </span>
<span class="sd">        | C(2n+1) |</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Inicializando matrizes</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>       <span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># Para cada item da matriz A, calcular o produto escalar correspondente</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span> <span class="o">*</span> <span class="n">phi</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">))</span>

        <span class="c1"># Para cada item da matriz B, calcular o produto escalar correspondente</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">phi</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span> <span class="o">*</span> <span class="n">zs</span><span class="p">)</span>

        <span class="c1"># Resolve o sistema linear, retornando sua solução, ou seja, retornando</span>
        <span class="c1"># a matriz coluna de coeficientes do ajuste</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span></div>


    <span class="c1">#######################  R2 GEN  ##############################################</span>

<div class="viewcode-block" id="h2_gen.gen_R2_coords_periodic">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen.gen_R2_coords_periodic">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gen_R2_coords_periodic</span><span class="p">(</span><span class="n">periodic_struct</span><span class="p">:</span> <span class="s2">&quot;periodic_structure&quot;</span><span class="p">,</span> 
                            <span class="n">nH2</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gera, para uma estrutura periódica, vários pontos no R2, </span>
<span class="sd">        dispostos em uma grade, que correspondem aos centros das </span>
<span class="sd">        moléculas de H2.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        periodic_struct : periodic_structure</span>
<span class="sd">            Estrutura periódica, dotada de vectores de célula.</span>

<span class="sd">        nH2 : int</span>
<span class="sd">            Quantidade de moléculas de H2 que deseja gerar para tal </span>
<span class="sd">            estrutura.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        list[np.ndarray]</span>
<span class="sd">            Lista de vetores no R2, com a coordenada dos centros gerados </span>
<span class="sd">            para as moléculas de H2. </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Encontrando menor quadrado perfeito, maior que nH2</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="n">nH2</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Se n for zero, retornar lista vazia</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># Lista de centros</span>
        <span class="n">H2_centers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Dimensão da célula da grade usada</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span>

        <span class="c1"># Malha de pontos discretos</span>
        <span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="p">))</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

        <span class="c1"># Vetores da cécula, a partir da exclusão da coordenada Z do vetores</span>
        <span class="c1"># da célula</span>
        <span class="n">vec0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">periodic_struct</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">vec1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">periodic_struct</span><span class="o">.</span><span class="n">vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Offset dos átomos em relação à origem</span>
        <span class="c1"># Isso evita que as moléculas fiquem na borda da célula</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">vec0</span> <span class="o">*</span> <span class="p">(</span><span class="n">step</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">vec1</span> <span class="o">*</span> <span class="p">(</span><span class="n">step</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Criando lista com todos os pontos da grade</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">))</span>

        <span class="c1"># De todos os pontos da grade sorteando apenas a quantidade necessária</span>
        <span class="kn">import</span> <span class="nn">random</span>
        <span class="n">chosen_points</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">nH2</span><span class="p">)</span>

        <span class="c1"># Para cada ponto escolhido, gerar as coordenadas de seu centro</span>
        <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chosen_points</span><span class="p">:</span>

            <span class="c1"># Gerando centro a partir da combinação linear dos vetores da célula</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec0</span> <span class="o">+</span>  <span class="n">Y</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">vec1</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>

            <span class="c1"># Listando centros</span>
            <span class="n">H2_centers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">H2_centers</span></div>


<div class="viewcode-block" id="h2_gen.gen_R2_coord_flake">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen.gen_R2_coord_flake">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gen_R2_coord_flake</span><span class="p">(</span><span class="n">struct</span><span class="p">:</span> <span class="s2">&quot;strucutre&quot;</span><span class="p">,</span> <span class="n">nH2</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gera, para uma estrutura de formato arredondado, no R2, uma lista de </span>
<span class="sd">        com posições de H2.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        struct : structure</span>
<span class="sd">            Estrutura para a qual se deseja gerar os centros de H2.</span>

<span class="sd">        nH2 : int </span>
<span class="sd">            Número de H2 desejado na molécula.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        list[np.ndarray]</span>
<span class="sd">            Lista, de vetores no R2, com as posições geradas para os centros</span>
<span class="sd">            de H2. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">tri_nums</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>

<span class="w">            </span><span class="sd">&quot;&quot;&quot;n-ésimo número triangular&quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">menor_triangular</span><span class="p">(</span><span class="n">nH2</span><span class="p">):</span>

<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            O menor m-ésimo número triangular, que quando usado para </span>
<span class="sd">            subdividir todos os triângulos, permite conter todas as nH2</span>
<span class="sd">            moléculas de H2 pretendidas.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="n">tri_nums</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nH2</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">m</span>

        <span class="k">def</span> <span class="nf">triangle_centers</span><span class="p">(</span><span class="n">vecs</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Divide o triângulo formado pelos vetores &#39;vecs&#39; em tri_nums(n) </span>
<span class="sd">            minitriângulos e retorna uma lista com seus centros.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            vecs : list[np.ndarray]</span>
<span class="sd">                Lista de dois vetores que geram o triângulo em questão.</span>

<span class="sd">            n : int</span>
<span class="sd">                refere o n-ésimo número triangular a ser usado na subsivisão</span>
<span class="sd">                do triângulo.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>

<span class="sd">            list[np.ndarray]</span>
<span class="sd">                Lista de todos os centros possíveis, em dada subdivisão, do</span>
<span class="sd">                triângulo.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">centers</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Vetores do triângulo unitário</span>
            <span class="n">vecs_unit</span> <span class="o">=</span> <span class="p">[</span><span class="n">vecs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">n</span><span class="p">,</span> <span class="n">vecs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">n</span><span class="p">]</span>

            <span class="c1"># offset</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="o">*</span> <span class="p">(</span><span class="n">vecs_unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">vecs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Centro de massas do primeiro triângulo</span>
            <span class="n">cm_unit</span> <span class="o">=</span> <span class="p">((</span><span class="n">vecs_unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">vecs_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># Para cada triângulo unitário</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

                    <span class="c1"># Apenas se tiver dentro do triângulo maior</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">+</span><span class="n">l</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
                        
                        <span class="c1"># Translação</span>
                        <span class="n">transl</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">vecs_unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span><span class="o">*</span><span class="n">vecs_unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                        <span class="c1"># Centro de massa transladado</span>
                        <span class="n">centers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">cm_unit</span> <span class="o">+</span> <span class="n">transl</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">centers</span>

        <span class="kn">import</span> <span class="nn">math</span>
        <span class="kn">import</span> <span class="nn">random</span>

        <span class="c1"># Se nenhum nH2 for gerado, retornar lista vazia</span>
        <span class="k">if</span> <span class="n">nH2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Raio estimado</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">graphine_radius</span><span class="p">(</span><span class="n">struct</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.95</span>

        <span class="c1"># Determinando dimensão dos triângulos</span>
        <span class="n">n_triangles</span> <span class="o">=</span> <span class="n">menor_triangular</span><span class="p">(</span><span class="n">nH2</span><span class="p">)</span>

        <span class="c1"># Listando os 6 vetores principais, que geram o hexágono</span>
        <span class="n">hex_vecs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">arc</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">arc</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">arc</span><span class="p">)</span>
            <span class="n">hex_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]))</span>

        <span class="c1"># Listando os 6 pares de vetores, que geram os 6 triângulos principais</span>
        <span class="n">tri_vecs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">tri_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">hex_vecs</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">6</span><span class="p">],</span> <span class="n">hex_vecs</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">6</span><span class="p">]])</span>

        <span class="c1"># Quantidade de moléculas em cada triângulo principal</span>
        <span class="n">unit_samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">nH2</span> <span class="o">//</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nH2</span> <span class="o">%</span> <span class="mi">6</span><span class="p">):</span>
            <span class="n">unit_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">unit_samples</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nH2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Sum of samples dosn&#39;t match nH2&quot;</span><span class="p">)</span>

        <span class="c1"># Para cada triângulo, gerar todos os centros possíveis, mas escolher </span>
        <span class="c1"># apenas a quantidade necessária</span>
        <span class="n">centers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vec_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tri_vecs</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">center</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>

                    <span class="n">triangle_centers</span><span class="p">(</span><span class="n">vecs</span><span class="o">=</span><span class="n">vec_pair</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_triangles</span><span class="p">),</span> <span class="n">unit_samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">):</span>
        
                <span class="n">centers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">centers</span></div>


    <span class="c1">#######################  Posicionador no R3  ##################################</span>

<div class="viewcode-block" id="h2_gen.gen_R3_H2">
<a class="viewcode-back" href="../../h2_gen.html#h2_gen.h2_gen.h2_gen.gen_R3_H2">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gen_R3_H2</span><span class="p">(</span><span class="n">R2_coords</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">otherside</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recebe pontos espalhados sobre um plano, e retorna pontos </span>
<span class="sd">        espalhados sobre uma superfície ajustada sobre os átomos da </span>
<span class="sd">        estrutura.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        R2_coord : list[np.ndarray]</span>
<span class="sd">            Lista de vetores no R2 que dão a posição dos centros de H2 </span>
<span class="sd">            dispostos no plano.</span>

<span class="sd">        C : np.ndarray</span>
<span class="sd">            Matriz coluna de coeficientes da função ajustada sobre os </span>
<span class="sd">            pontos da estrutura.</span>

<span class="sd">        otherside : bool</span>
<span class="sd">            Se é desejado gerar tais pontos no lado oposto da estrutura,</span>
<span class="sd">            ou seja, no lado onde z é negativo.</span>

<span class="sd">        vertical : bool</span>
<span class="sd">            Se é deseja que o eixo da molécula de H2 esteja orientada </span>
<span class="sd">            perpendicular à estrutura. Se False, o eixo será parelelo à</span>
<span class="sd">            estrutura, e sua rotação será aleatória.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        list[np.ndarray]</span>
<span class="sd">            Lista com vetores no R3 das posições de cada átomo de H, </span>
<span class="sd">            com posição ajustada de acordo com a curvatura da estrutura.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">math</span>

        <span class="n">plane_distance</span> <span class="o">=</span> <span class="mf">2.7</span>
        <span class="n">H2_bond_length</span> <span class="o">=</span> <span class="mf">0.7</span>
        
        <span class="k">if</span> <span class="n">vertical</span><span class="p">:</span>
            <span class="n">plane_distance</span> <span class="o">+=</span> <span class="n">H2_bond_length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Posições do H</span>
        <span class="n">H_coords</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Para cada posição na lista</span>
        <span class="k">for</span> <span class="n">R2_posic</span> <span class="ow">in</span> <span class="n">R2_coords</span><span class="p">:</span>

            <span class="c1"># Centro no R3</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R2_posic</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R2_posic</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">])</span>

            <span class="c1"># Componente Z  </span>
            <span class="k">if</span> <span class="n">otherside</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span> <span class="o">-</span> <span class="n">plane_distance</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span> <span class="o">+</span> <span class="n">plane_distance</span>
            
            <span class="c1"># Vetor distância do plano </span>
            <span class="n">plane_dist_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            
            <span class="c1"># Meio eixo do H2</span>
            <span class="k">if</span> <span class="n">vertical</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
                <span class="n">H2_axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">H2_bond_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="n">H2_axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">H2_bond_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">])</span>

            <span class="c1"># Posição dos dois H - centro, mais distância do plano, +/- meio eixo do H2</span>
            <span class="n">posic1</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">plane_dist_vec</span> <span class="o">+</span> <span class="n">H2_axis</span> 
            <span class="n">posic2</span> <span class="o">=</span> <span class="n">center</span> <span class="o">+</span> <span class="n">plane_dist_vec</span> <span class="o">-</span> <span class="n">H2_axis</span>

            <span class="c1"># Adicionar à estrutura</span>
            <span class="n">H_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posic1</span><span class="p">)</span>
            <span class="n">H_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posic2</span><span class="p">)</span>

        <span class="c1"># Retornar como array</span>
        <span class="k">return</span> <span class="n">H_coords</span></div>
</div>


    <span class="c1">###############################################################################</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Direitos autorais 2024, Gustavo Campos.</p>
  </div>

  Compilado com <a href="https://www.sphinx-doc.org/">Sphinx</a> usando um
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    fornecido por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>